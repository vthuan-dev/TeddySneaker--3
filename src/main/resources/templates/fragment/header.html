<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <!-- Add your head content here -->
</head>
<body>
<header class="header" th:fragment="header">
    <div class="header-middle">
        <div class="container">
            <div class="header-left col-lg-2 w-auto pl-0">
                <button class="mobile-menu-toggler text-primary mr-2" type="button">
                    <i class="icon-menu"></i>
                </button>
                <a href="/" class="logo">
                    <img th:src="@{https://static.vecteezy.com/system/resources/previews/023/606/821/non_2x/shoes-logo-design-sneakers-logo-design-vector.jpg}" alt="logo">
                </a>
            </div><!-- End .header-left -->

            <div class="header-right w-lg-max">
                <div class="header-icon header-search header-search-inline header-search-category w-lg-max text-right">
                    <a href="#" class="search-toggle search-button" role="button"><i class="icon-search-3"></i></a>
                    <div class="header-search-wrapper">
                        <input class="form-control search-input" placeholder="Nhập sản phẩm cần tìm kiếm..." required>
                        <button class="btn icon-search-3 p-0 search-button" type="submit"></button>
                    </div><!-- End .header-search-wrapper -->
                </div><!-- End .header-search -->

                <div class="header-contact d-none d-lg-flex pl-4 ml-3 mr-xl-5 pr-4">
                    <img th:src="@{/shop/images/phone.png}" alt="phone" width="30" height="30" class="pb-1">
                    <h6>Hotline <a href="tel:#" class="text-dark font1">034xxxxx51</a></h6>
                </div>

                <div class="dropdown cart-dropdown">
                    <a href="/cart" class="dropdown-toggle dropdown-arrow cart-toggle" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" data-display="static">
                        <i class="icon-shopping-cart"></i>
                        <span class="cart-count badge-circle" id="headerCartCount">0</span>
                    </a>

                    <div class="dropdown-menu">
                        <div class="dropdownmenu-wrapper">
                            <div class="dropdown-cart-header">
                                <span id="headerCartItemCount">0 SẢN PHẨM</span>
                                <a href="/cart" class="float-right">Xem giỏ hàng</a>
                            </div>

                            <div class="dropdown-cart-products" id="headerCartItems">
                                <!-- Cart items will be inserted here -->
                            </div>

                            <div class="dropdown-cart-total">
                                <span>Tổng cộng:</span>
                                <span class="cart-total-price float-right" id="headerCartTotal">0 ₫</span>
                            </div>

                            <div class="dropdown-cart-action">
                                <a href="/cart" class="btn btn-primary btn-block">Thanh toán</a>
                            </div>
                        </div>
                    </div>
                </div>

                <a href="#" data-toggle="modal" data-target="#exampleModal" class="header-icon account-setting">
                    <i class="icon-user-2"></i>
                </a>
            </div><!-- End .header-right -->
        </div><!-- End .container -->
    </div><!-- End .header-middle -->

    <div class="header-bottom sticky-header d-none d-lg-block">
        <div class="container">
            <nav class="main-nav w-100">
                <ul class="menu">
                    <li class="active">
                        <a href="/">Trang chủ</a>
                    </li>
                    <li class="float-right mr-0"><a href="/lien-he" class="px-4">Liên hệ</a></li>
                    <li class="float-right"><a href="/doi-hang">Chính sách</a></li>
                    <li class="float-right"><a href="/tin-tuc">Tin tức</a></li>
                    <li class="float-right"><a href="/san-pham">Sản phẩm</a></li>
                    <li class="float-right"><a id="nav-link-admin" href="/admin">Admin</a></li>
                </ul>
            </nav>
        </div><!-- End .container -->
    </div><!-- End .header-bottom -->
</header><!-- End .header -->

<!-- Thêm script để cập nhật giỏ hàng -->
<script>
function updateCartSummary() {
    fetch('/api/cart/summary', {
        method: 'GET',
        headers: {
            'Accept': 'application/json',
            'Content-Type': 'application/json'
        },
        credentials: 'include'
    })
    .then(response => {
        if (!response.ok) {
            throw new Error('Network response was not ok: ' + response.status);
        }
        return response.json();
    })
    .then(data => {
        // Cập nhật số lượng sản phẩm
        document.getElementById('headerCartCount').textContent = data.totalItems;
        document.getElementById('headerCartItemCount').textContent = `${data.totalItems} SẢN PHẨM`;
        
        // Cập nhật tổng tiền
        document.getElementById('headerCartTotal').textContent = `${formatPrice(data.totalPrice)} ₫`;
    })
    .catch(error => {
        console.error('Error fetching cart summary:', error);
        // Hiển thị giá trị mặc định khi có lỗi
        document.getElementById('headerCartCount').textContent = '0';
        document.getElementById('headerCartItemCount').textContent = '0 SẢN PHẨM';
        document.getElementById('headerCartTotal').textContent = '0 ₫';
    });
}

function formatPrice(price) {
    return new Intl.NumberFormat('vi-VN').format(price || 0);
}

// Cập nhật khi trang được tải
document.addEventListener('DOMContentLoaded', updateCartSummary);

// Cập nhật khi có thay đổi trong giỏ hàng
document.addEventListener('cartUpdated', updateCartSummary);
</script>

<style>
.cart-dropdown {
    position: relative;
    display: inline-block;
}

.cart-count {
    position: absolute;
    top: -8px;
    right: -8px;
    background-color: #ff0000;
    color: white;
    border-radius: 50%;
    padding: 2px 6px;
    font-size: 12px;
}

.dropdown-cart-products {
    max-height: 300px;
    overflow-y: auto;
}

.empty-cart {
    padding: 15px;
    text-align: center;
    color: #999;
}

.product {
    display: flex;
    padding: 10px;
    border-bottom: 1px solid #eee;
}

.product-details {
    flex: 1;
}

.product-title {
    margin: 0;
    font-size: 14px;
}

.cart-product-info {
    color: #999;
    font-size: 13px;
}

.product-image-container {
    width: 80px;
    margin-left: 10px;
}

.product-image img {
    max-width: 100%;
    height: auto;
}
</style>
</body>
</html>
