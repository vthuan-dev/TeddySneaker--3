<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
      th:replace="~{/layout/layout :: main-fragment(
                                                                     ~{:: title},
                                                                    'header',
                                                                    'footer',
                                                                     ~{:: #css-resources},
                                                                     ~{:: #js-resources},
                                                                     ~{:: #main-content}
                                                                    )}">
<head>
    <meta charset="UTF-8">
    <title th:text="${product.name}"></title>
    <th:block id="css-resources">
        <link rel="stylesheet" th:href="@{/shop/css/custom.css}">
        <style>
            .rating {
                display: flex;
                width: 100%;
                justify-content: center;
                overflow: hidden;
                flex-direction: row-reverse;
                height: 40px;
                position: relative;
            }

            .rating-0 {
                filter: grayscale(100%);
            }

            .rating > input {
                display: none;
            }

            .rating > label {
                cursor: pointer;
                width: 40px;
                height: 40px;
                margin-top: auto;
                background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' width='126.729' height='126.73'%3e%3cpath fill='%23e3e3e3' d='M121.215 44.212l-34.899-3.3c-2.2-.2-4.101-1.6-5-3.7l-12.5-30.3c-2-5-9.101-5-11.101 0l-12.4 30.3c-.8 2.1-2.8 3.5-5 3.7l-34.9 3.3c-5.2.5-7.3 7-3.4 10.5l26.3 23.1c1.7 1.5 2.4 3.7 1.9 5.9l-7.9 32.399c-1.2 5.101 4.3 9.3 8.9 6.601l29.1-17.101c1.9-1.1 4.2-1.1 6.1 0l29.101 17.101c4.6 2.699 10.1-1.4 8.899-6.601l-7.8-32.399c-.5-2.2.2-4.4 1.9-5.9l26.3-23.1c3.8-3.5 1.6-10-3.6-10.5z'/%3e%3c/svg%3e");
                background-repeat: no-repeat;
                background-position: center;
                background-size: 76%;
                transition: .3s;
            }

            .rating > input:checked ~ label,
            .rating > input:checked ~ label ~ label {
                background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' width='126.729' height='126.73'%3e%3cpath fill='%23fcd93a' d='M121.215 44.212l-34.899-3.3c-2.2-.2-4.101-1.6-5-3.7l-12.5-30.3c-2-5-9.101-5-11.101 0l-12.4 30.3c-.8 2.1-2.8 3.5-5 3.7l-34.9 3.3c-5.2.5-7.3 7-3.4 10.5l26.3 23.1c1.7 1.5 2.4 3.7 1.9 5.9l-7.9 32.399c-1.2 5.101 4.3 9.3 8.9 6.601l29.1-17.101c1.9-1.1 4.2-1.1 6.1 0l29.101 17.101c4.6 2.699 10.1-1.4 8.899-6.601l-7.8-32.399c-.5-2.2.2-4.4 1.9-5.9l26.3-23.1c3.8-3.5 1.6-10-3.6-10.5z'/%3e%3c/svg%3e");
            }

            .rating > input:not(:checked) ~ label:hover,
            .rating > input:not(:checked) ~ label:hover ~ label {
                background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' width='126.729' height='126.73'%3e%3cpath fill='%23d8b11e' d='M121.215 44.212l-34.899-3.3c-2.2-.2-4.101-1.6-5-3.7l-12.5-30.3c-2-5-9.101-5-11.101 0l-12.4 30.3c-.8 2.1-2.8 3.5-5 3.7l-34.9 3.3c-5.2.5-7.3 7-3.4 10.5l26.3 23.1c1.7 1.5 2.4 3.7 1.9 5.9l-7.9 32.399c-1.2 5.101 4.3 9.3 8.9 6.601l29.1-17.101c1.9-1.1 4.2-1.1 6.1 0l29.101 17.101c4.6 2.699 10.1-1.4 8.899-6.601l-7.8-32.399c-.5-2.2.2-4.4 1.9-5.9l26.3-23.1c3.8-3.5 1.6-10-3.6-10.5z'/%3e%3c/svg%3e");
            }

            .product-single-details {
                padding: 2rem;
                background: #fff;
                border-radius: 12px;
                box-shadow: 0 2px 15px rgba(0,0,0,0.05);
            }

            .product-title {
                font-size: 2rem;
                font-weight: 600;
                color: #2c3e50;
                margin-bottom: 1.5rem;
            }

            .product-info-box {
                background: #f8f9fa;
                padding: 1.5rem;
                border-radius: 8px;
            }

            .price-section {
                margin-bottom: 1.5rem;
            }

            .price-label {
                font-size: 0.9rem;
                color: #6c757d;
                margin-bottom: 0.5rem;
            }

            .current-price {
                font-size: 1.8rem;
                font-weight: 700;
                color: #e74c3c;
            }

            .product-stats {
                display: grid;
                gap: 1rem;
            }

            .stat-item {
                display: flex;
                align-items: center;
                gap: 0.5rem;
            }

            .stat-item i {
                color: #3498db;
            }

            .stat-label {
                color: #6c757d;
                font-size: 0.9rem;
            }

            .stat-value {
                font-weight: 500;
                color: #2c3e50;
            }

            .status-badge {
                padding: 0.25rem 0.75rem;
                border-radius: 50px;
                font-size: 0.85rem;
                font-weight: 500;
            }

            .out-of-stock {
                background: #fee2e2;
                color: #ef4444;
            }

            .size-selector {
                margin-top: 2rem;
            }

            .size-label {
                font-size: 0.9rem;
                color: #6c757d;
                margin-bottom: 0.5rem;
            }

            .form-select {
                width: 100%;
                padding: 0.75rem;
                border: 1px solid #e2e8f0;
                border-radius: 8px;
                font-size: 1rem;
                transition: all 0.3s ease;
            }

            .form-select:focus {
                border-color: #3498db;
                box-shadow: 0 0 0 2px rgba(52,152,219,0.2);
            }

            .action-buttons {
                display: grid;
                gap: 1rem;
                margin-top: 2rem;
            }

            .btn-add-cart {
                width: 100%;
                padding: 1rem;
                border: none;
                border-radius: 8px;
                background: #3498db;
                color: white;
                font-weight: 600;
                display: flex;
                align-items: center;
                justify-content: center;
                gap: 0.5rem;
                transition: all 0.3s ease;
            }

            .btn-add-cart:hover {
                background: #2980b9;
                transform: translateY(-1px);
            }

            .btn-buy-now {
                width: 100%;
                padding: 1rem;
                border: none;
                border-radius: 8px;
                background: #e74c3c;
                color: white;
                transition: all 0.3s ease;
            }

            .btn-buy-now.disabled {
                background: #95a5a6;
                cursor: not-allowed;
            }

            .buy-now-content {
                display: flex;
                justify-content: space-between;
                align-items: center;
            }

            .price-info {
                display: flex;
                flex-direction: column;
            }

            .price-label {
                font-size: 0.8rem;
                opacity: 0.9;
            }

            .price-value {
                font-weight: 600;
            }

            .buy-text {
                font-weight: 600;
                font-size: 1.1rem;
            }

            @media (max-width: 768px) {
                .product-single-details {
                    padding: 1rem;
                }

                .product-title {
                    font-size: 1.5rem;
                }

                .current-price {
                    font-size: 1.5rem;
                }
            }

            .size-box {
                width: 50px;
                height: 50px;
                border: 1px solid #ddd;
                display: flex;
                align-items: center;
                justify-content: center;
                cursor: pointer;
                border-radius: 4px;
                transition: all 0.3s;
            }

            .size-box:hover {
                border-color: #000;
            }

            .size-box.active {
                background-color: #000;
                color: white;
                border-color: #000;
            }

            .size-options {
                display: flex;
                flex-wrap: wrap;
                gap: 10px;
            }

            /* Product Gallery Styling */
            .product-gallery-container {
                position: relative;
                margin-bottom: 2rem;
                background-color: #fff;
                border-radius: 12px;
                overflow: hidden;
                box-shadow: 0 10px 30px rgba(0, 0, 0, 0.05);
            }

            .product-single-carousel {
                border-radius: 10px;
                overflow: hidden;
            }

            .product-single-carousel .owl-stage-outer {
                border-radius: 10px;
            }

            .product-item {
                position: relative;
                overflow: hidden;
                border-radius: 10px;
                background-color: #f8f9fa;
            }

            .product-single-image {
                width: 100%;
                height: auto;
                object-fit: contain;
                transition: transform 0.5s ease;
                cursor: zoom-in;
                aspect-ratio: 1 / 1;
            }

            .product-single-image:hover {
                transform: scale(1.03);
            }

            /* Thumbnails styling */
            .product-thumbnails {
                display: flex;
                flex-wrap: nowrap;
                overflow-x: auto;
                gap: 10px;
                margin-top: 15px;
                padding: 10px 0;
                scrollbar-width: thin;
            }

            .product-thumbnails::-webkit-scrollbar {
                height: 5px;
            }

            .product-thumbnails::-webkit-scrollbar-track {
                background: #f1f1f1;
                border-radius: 10px;
            }

            .product-thumbnails::-webkit-scrollbar-thumb {
                background: #ddd;
                border-radius: 10px;
            }

            .product-thumbnails::-webkit-scrollbar-thumb:hover {
                background: #3498db;
            }

            .thumbnail-item {
                flex: 0 0 auto;
                width: 80px;
                height: 80px;
                border-radius: 8px;
                overflow: hidden;
                border: 2px solid transparent;
                cursor: pointer;
                transition: all 0.3s ease;
                position: relative;
            }

            .thumbnail-item:hover {
                transform: translateY(-3px);
                box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            }

            .thumbnail-item.active {
                border-color: #3498db;
            }

            .thumbnail-item img {
                width: 100%;
                height: 100%;
                object-fit: cover;
            }

            /* Gallery actions */
            .gallery-actions {
                position: absolute;
                top: 15px;
                right: 15px;
                z-index: 10;
                display: flex;
                gap: 10px;
            }

            .prod-full-screen {
                width: 40px;
                height: 40px;
                display: flex;
                align-items: center;
                justify-content: center;
                background-color: rgba(255, 255, 255, 0.8);
                border-radius: 50%;
                cursor: pointer;
                transition: all 0.3s ease;
                box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
            }

            .prod-full-screen:hover {
                background-color: #fff;
                transform: scale(1.1);
            }

            .prod-full-screen i {
                color: #333;
                font-size: 1rem;
            }

            /* Custom Owl Carousel Navigation */
            .product-single-carousel .owl-nav {
                position: absolute;
                top: 50%;
                width: 100%;
                transform: translateY(-50%);
                display: flex;
                justify-content: space-between;
                pointer-events: none;
                padding: 0 10px;
            }

            .product-single-carousel .owl-nav button {
                width: 40px;
                height: 40px;
                background-color: rgba(255, 255, 255, 0.8) !important;
                border-radius: 50% !important;
                pointer-events: auto;
                transition: all 0.3s ease;
                display: flex;
                align-items: center;
                justify-content: center;
                box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
            }

            .product-single-carousel .owl-nav button:hover {
                background-color: #fff !important;
                transform: scale(1.1);
            }

            .product-single-carousel .owl-nav button i {
                color: #333;
                font-size: 1.2rem;
            }

            /* Zoom container styling */
            .zoomContainer {
                z-index: 9;
                overflow: hidden;
                border-radius: 10px;
            }

            /* Responsive adjustments */
            @media (max-width: 992px) {
                .thumbnail-item {
                    width: 70px;
                    height: 70px;
                }
            }

            @media (max-width: 767px) {
                .thumbnail-item {
                    width: 60px;
                    height: 60px;
                }
                
                .product-single-carousel .owl-nav {
                    display: none;
                }
            }

            /* Product Details Container */
            .product-details-container {
                padding: 2rem;
                background: #fff;
                border-radius: 20px;
                box-shadow: 0 10px 30px rgba(0, 0, 0, 0.05);
            }

            /* Product Title */
            .product-title {
                font-size: 2.5rem;
                font-weight: 600;
                color: #2c3e50;
                margin-bottom: 1.5rem;
                line-height: 1.2;
                letter-spacing: -0.5px;
            }

            /* Price Container */
            .price-container {
                margin-bottom: 2rem;
                padding: 1.5rem;
                background: linear-gradient(145deg, #f8f9fa, #ffffff);
                border-radius: 15px;
                box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            }

            .current-price-section {
                display: flex;
                align-items: center;
                gap: 1rem;
                margin-bottom: 0.5rem;
            }

            .price-amount {
                font-size: 2rem;
                font-weight: 700;
                color: #e74c3c;
            }

            .discount-badge {
                background: #e74c3c;
                color: white;
                padding: 0.3rem 0.8rem;
                border-radius: 20px;
                font-size: 0.9rem;
                font-weight: 600;
            }

            .original-price {
                color: #95a5a6;
                font-size: 0.9rem;
            }

            /* Product Stats */
            .product-stats-container {
                display: flex;
                gap: 2rem;
                margin-bottom: 2rem;
                padding: 1.5rem;
                background: #f8f9fa;
                border-radius: 15px;
            }

            .stat-item {
                display: flex;
                align-items: center;
                gap: 1rem;
            }

            .stat-icon {
                width: 40px;
                height: 40px;
                display: flex;
                align-items: center;
                justify-content: center;
                background: white;
                border-radius: 12px;
                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            }

            .stat-icon i {
                color: #3498db;
                font-size: 1.2rem;
            }

            .stat-info {
                display: flex;
                flex-direction: column;
            }

            .stat-label {
                font-size: 0.9rem;
                color: #7f8c8d;
            }

            .stat-value {
                font-size: 1.1rem;
                font-weight: 600;
                color: #2c3e50;
            }

            .status-badge {
                padding: 0.3rem 0.8rem;
                border-radius: 20px;
                font-weight: 600;
                font-size: 0.9rem;
            }

            .status-badge.in-stock {
                background: #2ecc71;
                color: white;
            }

            .status-badge.out-of-stock {
                background: #e74c3c;
                color: white;
            }

            /* Product Options */
            .product-options {
                margin-bottom: 2rem;
            }

            .option-title {
                font-size: 1.1rem;
                font-weight: 600;
                color: #2c3e50;
                margin-bottom: 1rem;
            }

            .option-choices {
                display: flex;
                gap: 1rem;
                flex-wrap: wrap;
            }

            .option-item {
                width: 60px;
                height: 60px;
                display: flex;
                align-items: center;
                justify-content: center;
                border: 2px solid #e0e0e0;
                border-radius: 12px;
                cursor: pointer;
                transition: all 0.3s ease;
                background: white;
                position: relative;
                overflow: hidden;
            }

            .option-item:hover {
                border-color: #3498db;
                transform: translateY(-2px);
                box-shadow: 0 5px 15px rgba(52, 152, 219, 0.1);
            }

            .option-item.active {
                border-color: #3498db;
                background: #3498db;
                color: white;
            }

            .option-item.active::after {
                content: '✓';
                position: absolute;
                top: 2px;
                right: 2px;
                font-size: 12px;
                color: white;
            }

            /* Action Buttons */
            .product-actions {
                display: flex;
                gap: 1rem;
            }

            .btn-add-cart, .btn-buy-now {
                flex: 1;
                padding: 1rem;
                border: none;
                border-radius: 12px;
                font-weight: 600;
                cursor: pointer;
                transition: all 0.3s ease;
                display: flex;
                align-items: center;
                justify-content: center;
                gap: 0.5rem;
            }

            .btn-add-cart {
                background: #f8f9fa;
                color: #2c3e50;
                border: 2px solid #e0e0e0;
            }

            .btn-add-cart:hover {
                background: #e0e0e0;
                transform: translateY(-2px);
            }

            .btn-buy-now {
                background: linear-gradient(145deg, #3498db, #2980b9);
                color: white;
                flex-direction: column;
            }

            .btn-buy-now:hover {
                transform: translateY(-2px);
                box-shadow: 0 5px 15px rgba(52, 152, 219, 0.3);
            }

            .buy-now-price {
                font-size: 1.2rem;
                font-weight: 700;
            }

            .buy-now-text {
                font-size: 0.9rem;
                opacity: 0.9;
            }

            /* Responsive Design */
            @media (max-width: 768px) {
                .product-title {
                    font-size: 2rem;
                }

                .product-actions {
                    flex-direction: column;
                }

                .product-stats-container {
                    flex-direction: column;
                    gap: 1rem;
                }
            }

            /* Animations */
            @keyframes fadeIn {
                from { opacity: 0; transform: translateY(10px); }
                to { opacity: 1; transform: translateY(0); }
            }

            .product-details-container {
                animation: fadeIn 0.5s ease-out;
            }

            /* Hover Effects */
            .product-details-container:hover {
                box-shadow: 0 15px 40px rgba(0, 0, 0, 0.08);
            }
        </style>
    </th:block>
</head>
<body>
<main class="main" id="main-content">
    <div class="container">
        <nav aria-label="breadcrumb" class="breadcrumb-nav">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="/"><i class="icon-home"></i></a></li>
                <li class="breadcrumb-item" th:text="${product.name}"></li>
            </ol>
        </nav>
        <div class="product-single-container product-single-default">
            <div class="row">
                <div class="col-md-6 product-single-gallery">
                    <div class="product-gallery-container">
                        <!-- Main Image Slider -->
                        <div class="product-single-carousel owl-carousel owl-theme">
                            <th:block th:each="img :${product.productImages}">
                                <div class="product-item">
                                    <img class="product-single-image" th:src="${img}" th:attr="data-zoom-image=${img}"/>
                                </div>
                            </th:block>
                        </div>
                        
                        <!-- Fullscreen button -->
                        <div class="gallery-actions">
                            <span class="prod-full-screen" title="Xem toàn màn hình">
                                <i class="fas fa-expand"></i>
                            </span>
                        </div>
                        
                        <!-- Thumbnails -->
                        <div class="product-thumbnails" id="carousel-custom-dots">
                            <th:block th:each="img, stat :${product.productImages}">
                                <div class="thumbnail-item" th:classappend="${stat.first ? 'active' : ''}">
                                    <img th:src="${img}" th:attr="data-index=${stat.index}"/>
                                </div>
                            </th:block>
                        </div>
                    </div>
                </div><!-- End .product-single-gallery -->

                <div class="col-md-6 product-single-details">
                    <div class="product-details-container">
                        <!-- Product Title -->
                        <h1 class="product-title">vòng ngọc trai</h1>

                        <!-- Price Section -->
                        <div class="price-container">
                            <div class="current-price-section">
                                <span class="price-amount">15,000₫</span>
                                <span class="discount-badge">-25%</span>
                            </div>
                            <div class="original-price">
                                <span>Giá gốc: </span>
                                <del>20,000₫</del>
                            </div>
                        </div>

                        <!-- Product Stats -->
                        <div class="product-stats-container">
                            <div class="stat-item">
                                <div class="stat-icon">
                                    <i class="fas fa-shopping-cart"></i>
                                </div>
                                <div class="stat-info">
                                    <span class="stat-label">Đã bán</span>
                                    <span class="stat-value">4 món</span>
                                </div>
                            </div>
                            
                            <div class="stat-item">
                                <div class="stat-icon">
                                    <i class="fas fa-box"></i>
                                </div>
                                <div class="stat-info">
                                    <span class="stat-label">Tình trạng</span>
                                    <span class="status-badge in-stock">Còn hàng</span>
                                </div>
                            </div>
                        </div>

                        <!-- Product Options -->
                        <div class="product-options">
                            <div class="option-section">
                                <h3 class="option-title">Chọn loại</h3>
                                <div class="option-choices">
                                    <div class="option-item" data-size="35" onclick="selectSize(this)">
                                        <span>35</span>
                                    </div>
                                    <div class="option-item" data-size="37" onclick="selectSize(this)">
                                        <span>37</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Action Buttons -->
                        <div class="product-actions">
                            <button class="btn-add-cart" onclick="addToCart(this)" data-product-id="4ImFfx">
                                <i class="fas fa-shopping-cart"></i>
                                <span>Thêm vào giỏ hàng</span>
                            </button>

                            <button class="btn-buy-now">
                                <span class="buy-now-price">15,000₫</span>
                                <span class="buy-now-text">Mua ngay</span>
                            </button>
                        </div>
                    </div>
                </div><!-- End .product-single-details -->
            </div><!-- End .row -->
        </div><!-- End .product-single-container -->

        <div class="product-single-tabs">
            <ul class="nav nav-tabs" role="tablist">
                <li class="nav-item">
                    <a class="nav-link active" id="product-tab-desc" data-toggle="tab" href="#product-desc-content" role="tab" aria-controls="product-desc-content" aria-selected="true">Mô tả chi tiết sản phẩm</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" id="product-tab-more-info" data-toggle="tab" href="#product-more-info-content" role="tab" aria-controls="product-more-info-content" aria-selected="false">Hình ảnh feedback</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" id="product-tab-reviews" data-toggle="tab" href="#product-reviews-content" role="tab" aria-controls="product-reviews-content" aria-selected="false">Đánh giá sản phẩm</a>
                </li>
            </ul>
            <div class="tab-content">
                <div class="tab-pane fade show active" id="product-desc-content" role="tabpanel" aria-labelledby="product-tab-desc">
                    <div class="product-desc-content">
                        <p th:utext="${product.description}"></p>
                    </div><!-- End .product-desc-content -->
                </div><!-- End .tab-pane -->

                <div class="tab-pane fade fade" id="product-more-info-content" role="tabpanel" aria-labelledby="product-tab-more-info">
                    <div class="products-slider owl-carousel owl-theme dots-top">
                        <th:block th:each="img :${product.feedbackImages}">
                            <div class="product-default inner-quickview inner-icon">
                                <figure>
                                   <img th:src="@{${img}}">
                                </figure>
                            </div>
                        </th:block>
                    </div><!-- End .products-slider -->
                </div><!-- End .tab-pane -->


                <div class="tab-pane fade" id="product-reviews-content" role="tabpanel" aria-labelledby="product-tab-reviews">
                    <div class="product-reviews-content">
                        <div class="row">
                            <div class="col-xl-6">
                                <ol class="comment-list">
                                    <th:block th:each="comment : ${product.comments}">
                                        <li class="comment-container">
                                            <div class="comment-avatar">
                                                <img th:src="@{/shop/images/avatar/avatar4.png}" width="65" height="65" alt="avatar"/>
                                            </div>
                                            <div class="comment-box">
                                                <div class="comment-info mb-1">
                                                    <h4 class="avatar-name" th:text="${comment.user.fullName}"></h4> - <span class="comment-date" th:text="${#dates.format(comment.createdAt, 'dd-MM-yyyy')}">Novemeber 15, 2019</span>
                                                </div>

                                                <div class="comment-text">
                                                    <p th:text="${comment.content}"></p>
                                                </div><!-- End .comment-text -->
                                            </div><!-- End .comment-box -->
                                        </li><!-- comment-container -->
                                    </th:block>
                                </ol><!-- End .comment-list -->
                            </div>

                            <div class="col-xl-6">
                                <div class="add-product-review">
                                    <form action="#" class="comment-form m-0" id="formCommentProduct">
                                        <div class="form-group">
                                            <label>Viết bình luận </label>
                                            <textarea cols="6" rows="6" name="product_comment" class="form-control form-control-sm product_comment"></textarea>
                                        </div><!-- End .form-group -->
                                        <button type="submit" class="btn btn-dark ls-n-15">Gửi bình luận</button>
                                    </form>
                                </div><!-- End .add-product-review -->
                            </div>
                        </div>
                    </div><!-- End .product-reviews-content -->
                </div><!-- End .tab-pane -->
            </div><!-- End .tab-content -->
        </div><!-- End .product-single-tabs -->

        <div class="products-section pt-0">
            <h2 class="section-title">Sản phẩm liên quan</h2>

            <div class="products-slider owl-carousel owl-theme dots-top">
                <th:block th:each="related : ${relatedProducts}">
                    <div class="product-default inner-quickview inner-icon">
                        <figure>
                            <a th:href="@{/{slug}/{id}(id=${related.id},slug=${related.slug})}">
                                <img th:src="@{${related.images}}">
                            </a>
                        </figure>
                        <div class="product-details">
                            <h3 class="product-title">
                                <a th:href="@{/{slug}/{id}(id=${related.id},slug=${related.slug})}" th:text="${related.name}"></a>
                            </h3>
                            <div class="price-box">
                                <th:block th:if="${related.promotionPrice}">
                                    <span class="product-price" th:text="${#numbers.formatDecimal(related.promotionPrice, 0, 'COMMA', 0, 'POINT') +' đ'}"></span>
                                    <del class="old-price" th:text="${#numbers.formatDecimal(related.price, 0, 'COMMA', 0, 'POINT') +' đ'}"></del>
                                </th:block>
                                <th:block th:unless="${related.promotionPrice}">
                                    <span class="product-price" th:text="${#numbers.formatDecimal(related.price, 0, 'COMMA', 0, 'POINT') +' đ'}"></span>
                                </th:block>
                            </div><!-- End .price-box -->
                            <div class="ratings-container">
                                <p class="card-text sold">&Dstrok;&atilde; b&aacute;n <span th:text="${related.totalSold}"></span> &dstrok;&ocirc;i</p>
                            </div><!-- End .product-container -->
                        </div><!-- End .product-details -->
                    </div>
                </th:block>
            </div><!-- End .products-slider -->
        </div><!-- End .products-section -->
    </div><!-- End .container -->

    <!-- Modals-->
    <th:block th:replace="~{fragment/size_choose_modal :: size-choose-modal}"></th:block>
</main><!-- End .main -->

<th:block id="js-resources">
    <script th:src="@{/shop/js/size-choose.js}"></script>
    <script th:src="@{/shop/js/bootstrap.bundle.min.js}"></script>
    <script th:src="@{/shop/js/plugins.min.js}"></script>

    <script th:inline="javascript">
        let sizeVn = [[${sizeVn}]];
        let selectedSize = null;

        $(function () {
            formatMoney();
            render();
            activeSize();
            sizeGuideRender();
        });

        function render() {
            for (let i = 0; i < sizeVn.length; i++) {
                let sizeChoose = `
            <div class="item" data-size="${sizeVn[i]}" data-id="${sizeVn[i]}">
                ${sizeVn[i]}
            </div>
            `;

                $('.size .select-filter').append(sizeChoose);
            };
        };

        function sizeGuideRender() {
            let tr = '';
            for (let i = 0; i < sizeVn.length; i++) {
                tr += `
            <tr>
              <td>${sizeVn[i]}</td>
            </tr>
            `;
            }
            $('.side-guide-table tbody').html(tr);
        }

        function activeSize() {
            let availableSizes = [[${availableSizes}]]

            for (let i = 0; i < sizeVn.length; i++) {
                if (sizeVn[i] == availableSizes[0]) {
                    $('.size-details').text(sizeVn[i])
                    break;
                }
            }

            $('.size .item').addClass('cross')
            $(`.item[data-size='${$('.size-details').text()}']`).addClass('size-choose').removeClass('cross');

            for (let i = 0; i < availableSizes.length; i++) {
                $(`.item[data-id='${availableSizes[i]}']`).removeClass('cross');
            }
        }

        $('.buy-now').click(function() {
            if (isLogined == true) {
                let size = $('.size-choose').data("id");
                if (size == null || size == "") {
                    toastr.warning("Sản phẩm tạm hết hàng. Vui lòng đặt hàng sau.");
                } else {
                    location.href = "/dat-hang?id="+[[${product.id}]]+"&size="+size;
                }
            } else {
                toastr.warning("Vui lòng đăng nhập để đặt hàng");
                setTimeout(function() {
                    $('#exampleModal').modal('show');
                }, 500);
            }
        })

        $("#formCommentProduct").submit(function (e) {
            e.preventDefault();
        }).validate({
            rules: {
                product_comment: {
                    required: true,
                    maxlength: 300
                }
            },
            messages: {
                product_comment: {
                    required: "Vui lòng nhập nội dung bình luận!",
                    maxlength: "Nội dung bình luận có độ dài tối đa 300 ký tự!",
                }
            },

            submitHandler: function () {
                let content = $(".product_comment").val();
                let productId = [[${product.id}]];
                req = {
                    content: content,
                    productId: productId
                }
                let myJson = JSON.stringify(req)
                $.ajax({
                    url: "/api/comments/product",
                    type: 'POST',
                    data: myJson,
                    contentType: "application/json; charset=utf-8",
                    success: function (data) {
                        $(".comment-list").append(`
                                <li class="comment-container">
                                            <div class="comment-avatar">
                                                <img src="/shop/images/avatar/avatar.png" width="65" height="65" alt="avatar"/>
                                            </div>
                                            <div class="comment-box">
                                                <div class="comment-text">
                                                    <p>${data.content}</p>
                                                </div>
                                            </div>
                                        </li>`)
                        $(".product_comment").val('');
                    },
                    error: function (error) {
                        toastr.warning("Vui lòng đăng nhập để bình luận");
                        setTimeout(function () {
                            $('#exampleModal').modal('show');
                        }, 500);
                    }
                });
            }
        });

        // $(".btn-rating").click(function (){
        //     let rating = $("#rating").val()
        //     console.log(rating)
        // })
        // $('.btn-rating input').on('change', function() {
        //     alert($('input[name=rating]:checked').val());
        // });

        function selectSize(element) {
            // Xóa class active từ tất cả các option
            document.querySelectorAll('.option-item').forEach(item => {
                item.classList.remove('active');
            });
            
            // Nếu click vào option đang được chọn, bỏ chọn nó
            if (selectedSize === element.getAttribute('data-size')) {
                selectedSize = null;
                // Disable nút mua ngay
                document.querySelector('.btn-buy-now').classList.add('disabled');
                return;
            }
            
            // Thêm class active cho option được chọn
            element.classList.add('active');
            selectedSize = element.getAttribute('data-size');
            
            // Enable nút mua ngay
            document.querySelector('.btn-buy-now').classList.remove('disabled');
            
            // Hiển thị thông báo nhỏ
            showToast(`Đã chọn loại: ${selectedSize}`);
        }

        function showToast(message) {
            // Tạo element cho toast
            const toast = document.createElement('div');
            toast.className = 'toast-notification';
            toast.textContent = message;
            
            // Thêm toast vào body
            document.body.appendChild(toast);
            
            // Thêm class show để hiển thị toast với animation
            setTimeout(() => toast.classList.add('show'), 10);
            
            // Xóa toast sau 2 giây
            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => toast.remove(), 300);
            }, 2000);
        }

        // Thêm style cho toast
        const style = document.createElement('style');
        style.textContent = `
            .toast-notification {
                position: fixed;
                bottom: 20px;
                left: 50%;
                transform: translateX(-50%) translateY(100px);
                background: rgba(52, 152, 219, 0.9);
                color: white;
                padding: 12px 24px;
                border-radius: 8px;
                font-size: 14px;
                z-index: 1000;
                opacity: 0;
                transition: all 0.3s ease;
            }

            .toast-notification.show {
                transform: translateX(-50%) translateY(0);
                opacity: 1;
            }
        `;
        document.head.appendChild(style);

        // Thêm validation cho form submit
        function validateForm() {
            if (!selectedSize) {
                showToast('Vui lòng chọn loại sản phẩm');
                return false;
            }
            return true;
        }

        // Cập nhật hàm addToCart
        function addToCart(button) {
            if (!selectedSize) {
                showToast('Vui lòng chọn loại sản phẩm trước khi thêm vào giỏ hàng');
                return;
            }
            
            // Tiếp tục với logic thêm vào giỏ hàng của bạn...
            const productId = button.getAttribute('data-product-id');
            // ... rest of your cart logic
        }

        $(document).ready(function() {
            // Initialize the main carousel
            $('.product-single-carousel').owlCarousel({
                items: 1,
                nav: true,
                dots: false,
                loop: true,
                margin: 0,
                navText: ['<i class="fas fa-chevron-left"></i>', '<i class="fas fa-chevron-right"></i>'],
                responsive: {
                    0: {
                        nav: false
                    },
                    768: {
                        nav: true
                    }
                }
            });

            // Image zoom effect
            $('.product-single-image').each(function() {
                $(this).ezPlus({
                    zoomType: 'inner',
                    cursor: 'crosshair',
                    zoomWindowFadeIn: 500,
                    zoomWindowFadeOut: 500,
                    easing: true,
                    responsive: true
                });
            });

            // Thumbnail click handler
            $('.thumbnail-item').on('click', function() {
                var index = $(this).find('img').data('index');
                $('.product-single-carousel').trigger('to.owl.carousel', [index, 300]);
                $('.thumbnail-item').removeClass('active');
                $(this).addClass('active');
            });

            // Update active thumbnail when carousel changes
            $('.product-single-carousel').on('changed.owl.carousel', function(event) {
                var index = event.item.index - event.relatedTarget._clones.length / 2;
                index = (index + event.item.count) % event.item.count;
                $('.thumbnail-item').removeClass('active');
                $('.thumbnail-item').eq(index).addClass('active');
            });

            // Full screen functionality
            $('.prod-full-screen').on('click', function() {
                var currentImg = $('.product-single-carousel .owl-item.active .product-single-image').attr('src');
                
                // Create modal for fullscreen view
                var fullscreenModal = $('<div class="modal fade" id="imageFullscreenModal" tabindex="-1" role="dialog" aria-hidden="true">' +
                    '<div class="modal-dialog modal-dialog-centered modal-xl">' +
                    '<div class="modal-content">' +
                    '<div class="modal-header">' +
                    '<button type="button" class="close" data-dismiss="modal" aria-label="Close">' +
                    '<span aria-hidden="true">&times;</span>' +
                    '</button>' +
                    '</div>' +
                    '<div class="modal-body d-flex justify-content-center align-items-center">' +
                    '<img src="' + currentImg + '" class="img-fluid" style="max-height: 90vh;">' +
                    '</div>' +
                    '</div>' +
                    '</div>' +
                    '</div>');
                
                // Append to body and show
                $('body').append(fullscreenModal);
                $('#imageFullscreenModal').modal('show');
                
                // Clean up on close
                $('#imageFullscreenModal').on('hidden.bs.modal', function() {
                    $(this).remove();
                });
            });
        });
    </script>
</th:block>
</body>
</html>